<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Manuel Ribeiro" />

<meta name="date" content="2022-05-31" />

<title>Documentation on EpiGeostats</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Documentation on EpiGeostats</h1>
<h4 class="author">Manuel Ribeiro</h4>
<h4 class="date">2022-05-31</h4>



<div id="epigeostats" class="section level2">
<h2>EpiGeostats</h2>
<p>EpiGeostats R package generates geostatistical disease maps using
block direct sequential simulation algorithm and provides visualization
tools for effective analysis and communication of disease risk map
results.</p>
<p>The package may also be used with mortality rates, or applied to
other fields like ecology or criminology.</p>
</div>
<div id="r-wrapper" class="section level2">
<h2>R wrapper</h2>
<p>EpiGeostats R package is a wrapper for running a geostatistical
software - dss.c.64.exe - to compute block direct sequential simulation
algorithm, and for calling pixelate R package (<a href="https://github.com/aimeertaylor/pixelate" class="uri">https://github.com/aimeertaylor/pixelate</a>) to plot
spatial risk uncertainty in disease risk maps.</p>
<p>Details on the geostatistical algorithm used in EpiGeostats are
described in Azevedo et al (<a href="https://doi.org/10.1186/s12942-020-00221-5" class="uri">https://doi.org/10.1186/s12942-020-00221-5</a>).</p>
<p>The package provides convenient wrappers to set parameters required
for geostatistical simulations and writes files in dss.c.64.exe readable
format, after which block direct sequential simulation algorithm can be
executed. Results generate a set of simulated disease risk, median risk
and spatial uncertainty maps, and a pixelated single-map with disease
risk and uncertainty, that can be extracted and/or plotted in R.</p>
</div>
<div id="getting-started" class="section level2">
<h2>Getting started</h2>
<p>The stand-alone software dss.c.64.exe is required to run EpiGeostats.
Therefore, the first step is to execute the following actions:</p>
<ol style="list-style-type: decimal">
<li>download dss.c.64.exe.zip from <a href="https://github.com/maluicr/dss" class="uri">https://github.com/maluicr/dss</a>,</li>
<li>create a folder called “input” in the working directory,</li>
<li>add the zipped dss.c.64.exe inside,</li>
<li>unzip the file into the same folder.</li>
</ol>
<p>You may execute these actions manually or directly from your R
console, running the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create folder input</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>inp <span class="ot">&lt;-</span> <span class="st">&quot;./input&quot;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(inp)) <span class="fu">dir.create</span>(inp, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># download dss.c.64.exe.zip from github</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>gitURL <span class="ot">&lt;-</span> <span class="st">&quot;https://github.com/maluicr/dss/raw/main/DSS.C.64.exe.zip&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">download.file</span>(<span class="at">url =</span> gitURL, <span class="at">destfile =</span> <span class="fu">file.path</span>(inp, <span class="st">&quot;DSS.C.64.exe.zip&quot;</span>))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># unzip file</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="fu">file.path</span>(inp, <span class="st">&quot;DSS.C.64.exe.zip&quot;</span>), <span class="at">exdir =</span> inp)</span></code></pre></div>
<p>Then, install the required packages using the following code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install devtools from CRAN</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">&quot;devtools&quot;</span>)){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;devtools&quot;</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># install packages from GitHub</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;maluicr/EpiGeostats&quot;</span>, <span class="at">build_vignettes =</span> <span class="cn">TRUE</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;aimeertaylor/pixelate&quot;</span>, <span class="at">build_vignettes =</span> <span class="cn">TRUE</span>, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="example" class="section level2">
<h2>Example</h2>
<p>As an example, we will show how to use EpiGeostats to perform disease
mapping of COVID-19 incidence and plot in a single-map disease risk and
spatial risk uncertainty.</p>
<p>The input required to run EpiGeostats R package are two datasets
:</p>
<ol style="list-style-type: decimal">
<li>block data, a data frame with incidence data (counts) per
region,</li>
<li>point data, a regular grid dataset with id region values at grid
nodes.</li>
</ol>
<p>In this example, EpiGeostats is used to map COVID-19 risk in Portugal
on January 15, 2021. The covid dataset <code>ptdata</code> and the
regular grid <code>ptgrid</code> comes with the package
<code>EpiGeostats</code>. The coordinate reference system is ETRS89 /
Portugal TM06 (EPSG: 3763) and coordinates are in metres.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load required libraries</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(EpiGeostats)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ptdata)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ptgrid)</span></code></pre></div>
<p>Block data refers to disease <code>data.frame</code> with spatial
data point locations (centroids), region id, number of disease cases and
size of population. Point data refers to a rectangular grid with region
id values at all simulation x, y coordinates (grid nodes). All unique id
regions in disease <code>data.frame</code> should be represented by 1 or
more grid nodes.</p>
<p>We need to transform <code>ptgrid</code> to
<code>SpatialPixelsDataFrame</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(ptgrid) <span class="ot">&lt;-</span> <span class="er">~</span>x<span class="sc">+</span>y</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">proj4string</span>(ptgrid) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+init=epsg:3763&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ptgrid)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SpatialPointsDataFrame&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;package&quot;)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sp&quot;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">gridded</span>(ptgrid) <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(ptgrid)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SpatialPixelsDataFrame&quot;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;package&quot;)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sp&quot;</span></span></code></pre></div>
<div id="compute-incidence-rates" class="section level4">
<h4>Compute incidence rates</h4>
<p>Compute incidence rates and variance-error term per region, with
function <code>irates()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute incidence rates</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>inc <span class="ot">&lt;-</span> <span class="fu">irates</span>(<span class="at">dfobj =</span> ptdata, <span class="at">oid =</span> <span class="st">&quot;oid_&quot;</span>, <span class="at">xx =</span> <span class="st">&quot;x&quot;</span>, <span class="at">yy =</span> <span class="st">&quot;y&quot;</span>, <span class="at">zz =</span> <span class="st">&quot;t&quot;</span>, </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">cases =</span> <span class="st">&quot;ncases&quot;</span>, <span class="at">pop =</span> <span class="st">&quot;pop19&quot;</span>, <span class="at">casesNA =</span> <span class="dv">1</span>, <span class="at">day =</span> <span class="st">&quot;20210115&quot;</span>)</span></code></pre></div>
<p>An incidence file is also created in a readable format for
dss.c.64.exe (.out) and stored in ‘./input’ folder.</p>
</div>
<div id="create-grid-node-file-for-dss.c.64.exe" class="section level4">
<h4>Create grid node file for dss.c.64.exe</h4>
<p>A regular gridded file with incidence data is also required for block
simulation with dss.c.64.exe. <code>grdfile()</code> function transforms
the gridded data into a readable format for dss.c.64.exe and prints it
into a text file (.out) in ‘./input’ folder.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create gridnode file</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>gnode <span class="ot">&lt;-</span> <span class="fu">grdfile</span>(<span class="at">rateobj =</span> inc, <span class="at">gridimage =</span> ptgrid, <span class="at">NAval =</span> <span class="sc">-</span><span class="dv">999</span>)</span></code></pre></div>
</div>
<div id="create-mask-file-for-dss.c.64.exe" class="section level4">
<h4>Create mask file for dss.c.64.exe</h4>
<p>A mask for the gridded file is required for dss.c.64.exe.
<code>maskfile()</code> function produces the required file (.out). The
only argument of the function is the name of list, output of function
<code>grdfile()</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mask <span class="ot">&lt;-</span> <span class="fu">maskfile</span>(gnode)</span></code></pre></div>
<p>The function returns a list of objects and generates a text file
(.out) with values {-1,0} where -1 are assigned to nodata locations and
0 are assigned to nodes with values (id region). The file is stored in
<code>./input</code> folder.</p>
</div>
<div id="estimate-incidence-rates-semi-variogram" class="section level4">
<h4>Estimate incidence rates semi-variogram</h4>
<p>Use <code>varexp()</code> to calculate experimental variogram from
COVID-19 rates. For now, <code>varexp()</code> is only implemented in
the omnidirectional case.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute experimental variogram</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>vexp <span class="ot">&lt;-</span> <span class="fu">varexp</span>(inc, <span class="at">lag =</span> <span class="dv">7000</span>, <span class="at">nlags =</span> <span class="dv">15</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot experimental variogram</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vexp[[<span class="st">&quot;semivar&quot;</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(gamma, <span class="st">&quot;(h)&quot;</span>)), <span class="at">xlab =</span> <span class="st">&quot;h (in m)&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Semi-variogram&quot;</span>) </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add estimated (weighted) sill</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> vexp[[<span class="st">&quot;weightsvar&quot;</span>]], <span class="at">col =</span><span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p>The function returns a list with the weighted variance (by population
size) and variogram estimates at nlags.</p>
</div>
<div id="fit-incidence-rates-theoretical-semi-variogram" class="section level4">
<h4>Fit incidence rates theoretical semi-variogram</h4>
<p>Function <code>varmodel()</code> fits (manually) a theoretical
semi-variogram. The user should provide the experimental semi-variogram
data to evaluate fit by visual inspection, the semi-variogram model type
and the semi-variogram parameters. For now, only spherical and
exponential models are implemented.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>vmod <span class="ot">&lt;-</span> <span class="fu">varmodel</span>(vexp, <span class="at">mod =</span> <span class="st">&quot;sph&quot;</span>, <span class="at">nug =</span> <span class="dv">0</span>, <span class="at">ran =</span> <span class="dv">35000</span>, <span class="at">sill =</span> vexp[[<span class="st">&quot;weightsvar&quot;</span>]])</span></code></pre></div>
<p>Plotting the fitted model:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot experimental variogram</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vexp[[<span class="st">&quot;semivar&quot;</span>]][<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">ylab =</span> <span class="fu">expression</span>(<span class="fu">paste</span>(gamma, <span class="st">&quot;(h)&quot;</span>)), <span class="at">xlab =</span> <span class="st">&quot;h (in m)&quot;</span>) </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add estimated sill</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> vexp[[<span class="st">&quot;weightsvar&quot;</span>]], <span class="at">col =</span><span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add theoretical model</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(vmod[[<span class="st">&quot;fittedval&quot;</span>]]) </span></code></pre></div>
</div>
<div id="create-parameter-file-and-invokes-dss.c.64.exe" class="section level4">
<h4>Create parameter file and invokes dss.c.64.exe</h4>
<p>Function <code>ssdpars()</code> generates a parameters file (.par)
and invokes dss.c.64.exe to run block direct sequential simulation.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssdpars</span>(<span class="at">blockobj =</span> block, <span class="at">maskobj =</span> mask, <span class="at">dfobj =</span> inc, <span class="at">varmobj =</span> vmod, </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">simulations =</span> <span class="dv">5</span>, <span class="at">radius1 =</span> <span class="dv">35000</span>, <span class="at">radius2 =</span> <span class="dv">35000</span>)</span></code></pre></div>
<p>Note that this process may take a while, depending mostly on the
number of simulation nodes and number of simulations specified. In the
end of the process, the block simulation maps are stored in .out
format.</p>
<p>Both parameters file (.par) and simulations files (.out) are stored
in <code>./input</code> folder.</p>
</div>
<div id="import-dss.c.64.exe-grid-outputs-in-r-readable-formats" class="section level4">
<h4>Import dss.c.64.exe grid outputs in R readable formats</h4>
<p><code>outraster()</code> allows to import to R the .out files
generated by dss.c.64.exe with a single-argument function. The user may
specify additional arguments to save maps in native raster package
format (.grd / .gri).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>maps <span class="ot">&lt;-</span> <span class="fu">outraster</span>(gnode)</span></code></pre></div>
</div>
<div id="plotting-disease-map-results" class="section level4">
<h4>Plotting disease map results</h4>
<p><code>spmap()</code> to plot disease risk map simulations:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">spmap</span>(maps, <span class="at">mapvar =</span> <span class="st">&quot;simulations&quot;</span>, <span class="at">simid =</span> <span class="dv">1</span>, <span class="at">legname =</span> <span class="st">&quot;Simulation #1&quot;</span>)</span></code></pre></div>
<p><code>spmap()</code> to plot median disease risk and spatial
uncertainty maps:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pixelate)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">spmap</span>(maps, <span class="at">mapvar =</span> <span class="st">&quot;etype&quot;</span>, <span class="at">legname =</span> <span class="st">&quot;Median </span><span class="sc">\n</span><span class="st"> incidence&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">spmap</span>(maps, <span class="at">mapvar =</span> <span class="st">&quot;uncertainty&quot;</span>, <span class="at">legname =</span> <span class="st">&quot;IQ range&quot;</span>)</span></code></pre></div>
<p><code>pxmap()</code> to plot pixelated map:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pxmap</span>(<span class="at">mapobj =</span> maps)</span></code></pre></div>
</div>
</div>
<div id="acknowledgements" class="section level2">
<h2>Acknowledgements</h2>
<p>Manuel Ribeiro acknowledges the financial support of the CERENA
(project FCT-UIDB/04028/2020) and Fundação para a Ciencia e Tecnologia
(research contract IF2018-CP1384). Manuel Ribeiro gratefully acknowledge
CERENA-IST/UL researchers Leonardo Azevedo, Maria João Pereira and
Amilcar Soares for providing code in Matlab and Fortran.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
